<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Switch (current.Current.Switch)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">current</a> &#x00BB; <a href="../index.html">Current</a> &#x00BB; Switch</nav><h1>Module <code>Current.Switch</code></h1><p>Like <code>Lwt_switch</code>, but the cleanup functions are called in sequence, not in parallel.</p></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>A switch limits the lifetime of an operation. Cleanup operations can be registered against the switch and will be called (in reverse order) when the switch is turned off.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <span>label:string</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>create ~label ()</code> is a fresh switch, initially on.</p><dl><dt>parameter label</dt><dd><p>If the switch is GC'd while on, this is logged in the error message.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-create_off"><a href="#val-create_off" class="anchor"></a><code><span class="keyword">val</span> create_off : unit <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>create_off ()</code> is a fresh switch, initially (and always) off.</p></dd></dl><dl><dt class="spec value" id="val-add_hook_or_exec"><a href="#val-add_hook_or_exec" class="anchor"></a><code><span class="keyword">val</span> add_hook_or_exec : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span>unit Lwt.t</span>)</span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>add_hook_or_exec switch fn</code> pushes <code>fn</code> on to the stack of functions to call when <code>t</code> is turned off. If <code>t</code> is already off, calls <code>fn</code> immediately. If <code>t</code> is in the process of being turned off, waits for that to complete and then runs <code>fn</code>.</p></dd></dl><dl><dt class="spec value" id="val-turn_off"><a href="#val-turn_off" class="anchor"></a><code><span class="keyword">val</span> turn_off : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>turn_off t</code> marks the switch as being turned off, then pops and calls clean-up functions in order. When the last one finishes, the switch is marked as off and cannot be used again. If the switch is already off, this does nothing. If the switch is already being turned off, it just waits for that to complete.</p></dd></dl><dl><dt class="spec value" id="val-is_on"><a href="#val-is_on" class="anchor"></a><code><span class="keyword">val</span> is_on : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>is_on t</code> is <code>true</code> if <code>turn_off t</code> hasn't yet been called.</p></dd></dl><dl><dt class="spec value" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span class="keyword">val</span> pp : <span><a href="index.html#type-t">t</a> Fmt.t</span></code></dt><dd><p>Prints the state of the switch (for debugging).</p></dd></dl></div></body></html>