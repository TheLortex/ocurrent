<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Engine (current.Current.Engine)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">current</a> &#x00BB; <a href="../index.html">Current</a> &#x00BB; Engine</nav><h1>Module <code>Current.Engine</code></h1><p>The main event loop.</p></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dt class="spec type" id="type-results"><a href="#type-results" class="anchor"></a><code><span class="keyword">type</span> results</code><code> = </code><code>{</code><table class="record"><tr id="type-results.value" class="anchored"><td class="def field"><a href="#type-results.value" class="anchor"></a><code>value : <span>unit <a href="../../Current_term/Output/index.html#type-t">Current_term.Output.t</a></span>;</code></td></tr><tr id="type-results.jobs" class="anchored"><td class="def field"><a href="#type-results.jobs" class="anchor"></a><code>jobs : <span><a href="../class-type-actions/index.html">actions</a> <a href="../Job/index.html#module-Map">Job.Map</a>.t</span>;</code></td><td class="doc"><p>The jobs currently being used (whether running or finished).</p></td></tr></table><code>}</code></dt></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <span>?&#8288;config:<a href="../Config/index.html#type-t">Config.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;trace:<span>(<span>next:<span>unit Lwt.t</span></span> <span>&#45;&gt;</span> <a href="index.html#type-results">results</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-term">term</a></span>)</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>create pipeline</code> is a new engine running <code>pipeline</code>. The engine will evaluate <code>t</code>'s pipeline immediately, and again whenever one of its inputs changes.</p></dd></dl><dl><dt class="spec value" id="val-update"><a href="#val-update" class="anchor"></a><code><span class="keyword">val</span> update : unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Primitives should call this after using <a href="../../../current_incr/Current_incr/index.html#val-change"><code>Current_incr.change</code></a> to run another step of the engine loop. This will (asynchronously) call <a href="../../../current_incr/Current_incr/index.html#val-propagate"><code>Current_incr.propagate</code></a> and perform any end-of-propagation activities.</p></dd></dl><dl><dt class="spec value" id="val-state"><a href="#val-state" class="anchor"></a><code><span class="keyword">val</span> state : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-results">results</a></code></dt><dd><p>The most recent results from evaluating the pipeline.</p></dd></dl><dl><dt class="spec value" id="val-jobs"><a href="#val-jobs" class="anchor"></a><code><span class="keyword">val</span> jobs : <a href="index.html#type-results">results</a> <span>&#45;&gt;</span> <span><a href="../class-type-actions/index.html">actions</a> <a href="../Job/index.html#module-Map">Job.Map</a>.t</span></code></dt><dt class="spec value" id="val-thread"><a href="#val-thread" class="anchor"></a><code><span class="keyword">val</span> thread : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span></code></dt><dd><p><code>thread t</code> is the engine's thread. Use this to monitor the engine (in case it crashes).</p></dd></dl><dl><dt class="spec value" id="val-config"><a href="#val-config" class="anchor"></a><code><span class="keyword">val</span> config : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Config/index.html#type-t">Config.t</a></code></dt><dt class="spec value" id="val-pipeline"><a href="#val-pipeline" class="anchor"></a><code><span class="keyword">val</span> pipeline : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-term">term</a></span></code></dt><dt class="spec value" id="val-update_metrics"><a href="#val-update_metrics" class="anchor"></a><code><span class="keyword">val</span> update_metrics : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>update_metrics t</code> reports how many pipeline stages are in each state via Prometheus. Call this on each metrics collection if you have exactly one pipeline. The default web UI does this automatically.</p></dd></dl><dl><dt class="spec value" id="val-on_disable"><a href="#val-on_disable" class="anchor"></a><code><span class="keyword">val</span> on_disable : <span>(unit <span>&#45;&gt;</span> unit)</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>on_disable fn</code> schedules <code>fn ()</code> to be called after the next evaluation. You can increment a ref-count when calling this and then check it when the callback is called. If it is then zero, the operation is no longer required and you can e.g. cancel the job.</p></dd></dl><div class="spec module" id="module-Step"><a href="#module-Step" class="anchor"></a><code><span class="keyword">module</span> <a href="Step/index.html">Step</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></div></body></html>